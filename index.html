<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>é¦¬å¹´ 16 å®®æ ¼æ·±åº¦æŒ‘æˆ°è³½</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* è¼‰å…¥ Noto Sans TC ä½œç‚ºå¾®è»Ÿæ­£é»‘é«”çš„å¾Œå‚™ï¼Œç¢ºä¿è·¨å¹³å°ç²—é«”æ•ˆæœä¸€è‡´ */
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700;900&display=swap');

        :root {
            --cny-red: #d62828;
            --cny-gold: #f9d423;
        }

        /* å…¨åŸŸå­—é«”è¨­å®šç‚ºå¾®è»Ÿæ­£é»‘é«” */
        body {
            background-color: #1a1a1a;
            background-image: linear-gradient(rgba(0, 0, 0, 0.75), rgba(0, 0, 0, 0.75)), 
                              url('https://media.istockphoto.com/id/2222690159/zh/%E5%90%91%E9%87%8F/2026-year-of-the-horse-vector-new-years-greeting-card-template-with-a-prancing-horse-silhouette.jpg?s=612x612&w=0&k=20&c=SC_ro4OIkUOaT83ENW2SQsCwcimuDXeMOikrwxDRoIs=');
            background-size: cover;
            background-position: center;
            background-attachment: scroll;
            font-family: "Microsoft JhengHei", "å¾®è»Ÿæ­£é»‘é«”", "Noto Sans TC", sans-serif;
            color: white;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: env(safe-area-inset-top) 16px env(safe-area-inset-bottom);
            overflow-x: hidden;
            -webkit-tap-highlight-color: transparent;
        }

        @media (min-width: 768px) {
            body { background-attachment: fixed; }
        }

        /* ä¸»æ¨™é¡Œï¼šå¾®è»Ÿæ­£é»‘é«” + è¶…ç²—é«” */
        .cny-title {
            font-weight: 900;
            font-size: clamp(2.2rem, 10vw, 4rem);
            color: var(--cny-gold);
            text-shadow: 3px 3px 0px #000;
            margin-top: 1rem;
            margin-bottom: 0.5rem;
            z-index: 10;
            letter-spacing: 2px;
        }

        /* æ¬¡æ¨™é¡Œï¼šå¾®è»Ÿæ­£é»‘é«” + ç²—é«” */
        .cny-subtitle {
            font-weight: 700;
            font-size: clamp(1rem, 4vw, 1.5rem);
            color: var(--cny-gold);
            z-index: 10;
            margin-bottom: 2rem;
            opacity: 0.95;
            letter-spacing: 1px;
        }

        .grid-container {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: clamp(8px, 2vw, 15px);
            max-width: 550px;
            width: 100%;
            z-index: 10;
            touch-action: manipulation;
        }

        .punch-card {
            aspect-ratio: 1 / 1;
            background: linear-gradient(135deg, var(--cny-red), #b21e1e);
            border: 2px solid var(--cny-gold);
            border-radius: 12px;
            position: relative;
            cursor: pointer;
            transition: transform 0.2s cubic-bezier(0.34, 1.56, 0.64, 1), box-shadow 0.2s, background 0.2s;
            box-shadow: 0 4px 0px #5e0000;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: clamp(1.2rem, 5vw, 2.2rem);
            font-weight: 900;
            color: var(--cny-gold);
            will-change: transform;
        }

        @media (hover: hover) {
            .punch-card:hover:not(.poked) {
                transform: translateY(-5px);
                background: #e63946;
                box-shadow: 0 8px 0px #5e0000;
            }
        }

        .punch-card:active:not(.poked) {
            transform: scale(0.9) translateY(2px);
            box-shadow: 0 2px 0px #5e0000;
        }

        .punch-card.poked {
            background: #2a0000;
            border-color: #4a0000;
            color: #444;
            box-shadow: inset 0 4px 8px rgba(0,0,0,0.6);
            transform: scale(0.95);
            cursor: default;
        }

        .music-control {
            position: fixed;
            top: 15px;
            left: 15px;
            z-index: 100;
            background: rgba(0,0,0,0.7);
            border: 2px solid var(--cny-gold);
            border-radius: 50%;
            width: 44px;
            height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            backdrop-filter: blur(4px);
        }

        .music-control.muted::after {
            content: '';
            position: absolute;
            width: 2px;
            height: 24px;
            background: #ff4d4d;
            transform: rotate(45deg);
        }

        .logo-link {
            position: fixed;
            top: 15px;
            right: 15px;
            z-index: 50;
        }

        .logo-img {
            height: 42px;
            background: rgba(0, 0, 0, 0.7);
            padding: 6px;
            border-radius: 8px;
            border: 1px solid rgba(255, 215, 0, 0.4);
            backdrop-filter: blur(4px);
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            z-index: 200;
            justify-content: center;
            align-items: center;
            padding: 16px;
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background: #fff;
            color: #333;
            padding: clamp(20px, 5vw, 32px);
            border-radius: 24px;
            max-width: 450px;
            width: 100%;
            text-align: center;
            border: 8px solid var(--cny-gold);
            max-height: 85vh;
            overflow-y: auto;
            position: relative;
        }

        .option-btn {
            display: block;
            width: 100%;
            padding: 14px;
            margin: 10px 0;
            background: #fffafa;
            border: 2px solid #fee2e2;
            border-radius: 12px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 700;
            transition: all 0.2s;
        }

        .option-btn:active {
            background: #fff3cd;
            border-color: var(--cny-gold);
            transform: scale(0.98);
        }

        .footer-info {
            margin-top: auto;
            padding: 30px 0 20px;
            text-align: center;
            color: rgba(255, 255, 255, 1);
            font-size: 1.1rem;
            font-weight: 900; /* è¨­è¨ˆè€…è³‡è¨Šè¨­å®šç‚ºæœ€ç²—é«” */
            z-index: 10;
            letter-spacing: 1px;
        }

        .confetti {
            position: fixed;
            width: 8px;
            height: 8px;
            pointer-events: none;
            z-index: 1000;
        }
    </style>
</head>
<body>

    <audio id="bgMusic" loop preload="auto">
        <source src="https://cdn.pixabay.com/audio/2022/02/07/audio_27914620f3.mp3" type="audio/mpeg">
    </audio>

    <div class="music-control" id="musicBtn" onclick="toggleMusic()">
        <svg viewBox="0 0 24 24" width="20" height="20" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round" style="color: var(--cny-gold);">
            <path d="M9 18V5l12-2v13"></path>
            <circle cx="6" cy="18" r="3"></circle>
            <circle cx="18" cy="16" r="3"></circle>
        </svg>
    </div>

    <h1 class="cny-title">é¦¬åˆ°æˆåŠŸæˆ³æˆ³æ¨‚</h1>
    <p class="cny-subtitle text-center px-4">ä¸€é¦¬ç•¶å…ˆï¼16 é“è¶£å‘³æŒ‘æˆ°ç­‰ä½ ä¾†ç ´ï¼</p>

    <div class="grid-container" id="gridContainer"></div>

    <div class="footer-info">
        è¨­è¨ˆè€…ï¼šæ„›è¿ªæ¨‚ é¾å­Ÿä¿® è·èƒ½æ²»ç™‚å¸«
    </div>

    <a href="https://adlers.tw/" target="_blank" class="logo-link">
        <img src="https://adlers.tw/wp-content/uploads/2021/05/ADL-LOGO_v2.png" alt="æ„›è¿ªæ¨‚ Logo" class="logo-img">
    </a>

    <div class="modal" id="gameModal">
        <div class="modal-content" id="modalContent">
            <div id="questionView">
                <div class="flex justify-center mb-3">
                    <span class="bg-red-50 text-red-600 px-3 py-1 rounded-full text-xs font-bold tracking-widest" id="questionCategory">é¦¬å¹´ç‰¹é¸</span>
                </div>
                <h2 id="questionText" class="text-xl font-bold mb-6 leading-tight text-gray-800">è¼‰å…¥ä¸­...</h2>
                <div id="optionsGroup"></div>
            </div>

            <div id="resultView" class="hidden">
                <div id="feedbackIcon" class="text-6xl mb-3">ğŸ</div>
                <h3 id="feedbackTitle" class="text-2xl font-bold mb-3"></h3>
                
                <div class="mb-4 p-3 bg-green-50 rounded-xl border border-green-100">
                    <p class="text-[10px] text-green-600 font-bold uppercase mb-1">æ­£ç¢ºç­”æ¡ˆ</p>
                    <p id="correctAnswerText" class="text-lg font-black text-green-700"></p>
                </div>

                <div class="explanation-box">
                    <p class="font-bold text-gray-800 text-sm mb-1">ğŸ’¡ å…¸æ•…è§£æ</p>
                    <p id="explanationText" class="text-sm text-gray-700 leading-relaxed"></p>
                </div>

                <div id="missionBox" class="mt-4 p-3 bg-orange-50 rounded-xl border border-orange-100 hidden">
                    <p class="text-[10px] font-bold text-orange-500 mb-1">ğŸ“¢ è½‰é‹å°æŒ‘æˆ°</p>
                    <p id="missionText" class="text-md text-orange-800 font-bold"></p>
                </div>

                <button onclick="closeModal()" class="mt-6 w-full bg-red-600 text-white px-6 py-4 rounded-2xl font-black text-lg shadow-[0_4px_0_#9d0208] active:translate-y-1 active:shadow-none">
                    ç¹¼çºŒæŒ‘æˆ°ï¼
                </button>
            </div>
        </div>
    </div>

    <script>
        const questions = [
            { q: "æˆèªã€Œé¾é¦¬ç²¾ç¥ã€ä¸­çš„ã€Œé¾é¦¬ã€ï¼Œåœ¨å¤ä»£å‚³èªªä¸­æ˜¯æŒ‡ä»€éº¼æ¨£çš„é¦¬ï¼Ÿ", a: ["é•·äº†ç¿…è†€çš„é¦¬", "é¦¬é ­é¾èº«çš„é§¿é¦¬", "è·‘å¾—æœ€å¿«çš„é¦¬"], correct: 1, exp: "é¾é¦¬æ˜¯å¤ä»£å‚³èªªä¸­ä¸€ç¨®åƒé¾åˆåƒé¦¬çš„ç¥ç¸ï¼Œè±¡å¾µå¥æ—ºéå‡¡çš„ç²¾ç¥ç‹€æ…‹ã€‚" },
            { q: "æ­·å²ä¸Šè‘—åçš„ã€Œèµ¤å…”é¦¬ã€æ›¾æ˜¯å“ªä½å‚³å¥‡æ­¦å°‡çš„åé¨ï¼Ÿ", a: ["å¼µé£›", "é—œç¾½", "è¶™é›²"], correct: 1, exp: "èµ¤å…”é¦¬ã€Œæ—¥è¡Œåƒé‡Œï¼Œæ¸¡æ°´ç™»å±±ã€ï¼Œå…ˆå¾Œç‚ºå‘‚å¸ƒèˆ‡é—œç¾½æ•ˆåŠ›ï¼Œæ˜¯åé¦¬çš„ä»£åè©ã€‚" },
            { q: "æˆèªã€Œé¦¬åˆ°æˆåŠŸã€æœ€åˆæ˜¯å½¢å®¹ä»€éº¼æ¨£çš„å ´æ™¯ï¼Ÿ", a: ["æ‰“ä»—å¤§ç²å…¨å‹", "è€ƒè©¦è€ƒç¬¬ä¸€å", "åšç”Ÿæ„ç™¼è²¡"], correct: 0, exp: "èµ·æºæ–¼æˆ°å ´ï¼Œå½¢å®¹æˆ°é¦¬ä¸€åˆ°å‰ç·šä¾¿å–å¾—å‹åˆ©ï¼Œç¾åœ¨å¤šç”¨æ–¼ç¥è³€äº‹æƒ…é †åˆ©é”æˆã€‚" },
            { q: "åœ¨åäºŒç”Ÿè‚–ä¸­ï¼Œé¦¬çš„æ’åˆ—é †åºæ˜¯ç¬¬å¹¾ä½ï¼Ÿ", a: ["ç¬¬äº”ä½", "ç¬¬ä¸ƒä½", "ç¬¬ä¹ä½"], correct: 1, exp: "ç”Ÿè‚–é †åºç‚ºï¼šé¼ ç‰›è™å…”é¾è›‡é¦¬ç¾ŠçŒ´é›ç‹—è±¬ã€‚é¦¬æ’åœ¨ç¬¬ä¸ƒä½ã€‚" },
            { q: "å‚³èªªä¸­èƒ½æ—¥è¡Œåƒé‡Œçš„åé¦¬ï¼Œå¿…é ˆè¦æœ‰èª°çš„è³è­˜æ‰èƒ½è¢«ç™¼ç¾ï¼Ÿ", a: ["ä¼¯æ¨‚", "é½Šå®£ç‹", "ç§¦å§‹çš‡"], correct: 0, exp: "ã€Œä¸–æœ‰ä¼¯æ¨‚ï¼Œç„¶å¾Œæœ‰åƒé‡Œé¦¬ã€ã€‚ä¼¯æ¨‚ä»¥å–„æ–¼ç›¸é¦¬è‘—ç¨±ï¼Œæ¯”å–»èƒ½è­˜åˆ¥äººæçš„äººã€‚" },
            { q: "ã€Šè¥¿éŠè¨˜ã€‹ä¸­ï¼Œå”ä¸‰è—é¨çš„ã€Œç™½é¾é¦¬ã€åŸæœ¬æ˜¯ä»€éº¼èº«ä»½ï¼Ÿ", a: ["ä¸€åŒ¹æ™®é€šçš„é‡é¦¬", "è¥¿æµ·é¾ç‹ä¸‰å¤ªå­", "å¤©ä¸Šçš„å¤©é¦¬"], correct: 1, exp: "ç™½é¾é¦¬æœ¬æ˜¯è¥¿æµ·é¾ç‹ä¹‹å­å‚²çƒˆï¼Œå› çŠ¯éŒ¯è¢«è²¶ï¼Œå¾ŒåŒ–ç‚ºç™½é¦¬è­·é€å”åƒ§å–ç¶“ã€‚" },
            { q: "éå¹´æ™‚ã€Œå€’è²¼ç¦å­—ã€çš„ç”±ä¾†ï¼Œç›¸å‚³èˆ‡å“ªä½çš‡åçš„æ©Ÿæ™ºæœ‰é—œï¼Ÿ", a: ["é•·å­«çš‡å", "é¦¬çš‡å", "æ­¦å‰‡å¤©"], correct: 1, exp: "æ˜æœé¦¬çš‡åç‚ºæ•‘ä¸€å®¶èª¤å°‡ç¦å­—è²¼å€’çš„ç™¾å§“ï¼Œç¬‘ç¨±æ˜¯ã€Œç¦åˆ°äº†ã€ï¼Œå¾æ­¤æˆç‚ºç¿’ä¿—ã€‚" },
            { q: "å¤§å¹´åˆä¸€çš„ç¬¬ä¸€é¤ï¼Œè¨±å¤šå®¶åº­ç¿’æ…£åƒã€Œé¤ƒå­ã€ï¼Œæ˜¯ç‚ºäº†æ±‚ä»€éº¼ï¼Ÿ", a: ["æ‹›è²¡é€²å¯¶", "é•·å‘½ç™¾æ­²", "æ­¥æ­¥é«˜å‡"], correct: 0, exp: "é¤ƒå­å½¢ç‹€åƒé‡‘å…ƒå¯¶ï¼Œéå¹´åƒé¤ƒå­æœ‰è²¡æºå»£é€²çš„å‰ç¥¥å¯“æ„ã€‚" },
            { q: "éå¹´å‚³çµ±ç¾é£Ÿã€Œå¹´ç³•ã€ï¼Œå…¶è«§éŸ³å¯“æ„è‘—ä»€éº¼ï¼Ÿ", a: ["å¹´å¹´æœ‰é¤˜", "å¹´å¹´é«˜å‡", "åˆå®¶åœ˜åœ“"], correct: 1, exp: "ã€Œå¹´ç³•ã€èˆ‡ã€Œå¹´é«˜ã€è«§éŸ³ï¼Œå¯“æ„å°å­©èº«é«˜é•·å¾—é«˜ï¼Œå¤§äººäº‹æ¥­æ­¥æ­¥é«˜å‡ã€‚" },
            { q: "ã€Œå£“æ­²éŒ¢ã€ä¸­çš„ã€Œæ­²ã€ï¼Œåœ¨å¤ä»£å‚³èªªä¸­å…¶å¯¦æ˜¯æŒ‡ä»€éº¼ï¼Ÿ", a: ["æ™‚é–“", "å¦–ç¸ã€Œç¥Ÿã€", "æ­²éŒ¢"], correct: 1, exp: "å‚³èªªã€Œç¥Ÿã€æ˜¯é™¤å¤•å‡ºç¾çš„å¦–æ€ªï¼Œçˆ¶æ¯ç”¨éŒ¢æ”¾åœ¨æ•é ­ä¸‹å£“ä½ï¼Œç¨±ç‚ºã€Œå£“ç¥Ÿã€ï¼Œå¾Œæ¼”è®Šç‚ºå£“æ­²éŒ¢ã€‚" },
            { q: "æ˜¥è¯çš„ç¥–å…ˆè¢«ç¨±ç‚ºã€Œæ¡ƒç¬¦ã€ï¼Œæœ€åˆæ˜¯ç”¨ä¾†å¹¹å˜›çš„ï¼Ÿ", a: ["å¯«é¡˜æœ›", "è£é£¾é–€æ¡†", "é©…é‚ªé¿é¬¼"], correct: 2, exp: "å¤äººå°‡ç¥åƒåˆ»åœ¨æ¡ƒæœ¨æ¿ä¸Šæ›é–€å£ï¼Œç”¨ä¾†éœ‡æ‡¾é¬¼ç¥ï¼Œé€™å°±æ˜¯æ˜¥è¯æœ€æ—©çš„å½¢å¼ã€‚" },
            { q: "é™¤å¤•å¤œå…¨å®¶äººèšåœ¨ä¸€èµ·åƒçš„é€™é “é£¯ï¼Œæ­£å¼åç¨±æ˜¯ä»€éº¼ï¼Ÿ", a: ["åœ˜åœ“é£¯", "å¹³å®‰é£¯", "å¹´å¤œé£¯"], correct: 2, exp: "å¹´å¤œé£¯åˆç¨±åœçˆï¼Œæ˜¯éå¹´æœŸé–“æœ€é‡è¦çš„å„€å¼ï¼Œè±¡å¾µå…¨å®¶åœ˜èšã€è¾­èˆŠè¿æ–°ã€‚" },
            { q: "å‚³èªªã€Œå¹´ç¸ã€æœ€å®³æ€•çš„ã€Œä¸‰ä»¶å¯¶ã€æ˜¯ä»€éº¼ï¼Ÿ", a: ["å¤§è²å…¬ã€ç«æŠŠã€æ£å­", "ç´…ç´™ã€ç«å…‰ã€éŸ¿è²", "é£Ÿç‰©ã€ç¾é…’ã€éŸ³æ¨‚"], correct: 1, exp: "å¹´ç¸æ€•ç´…ã€æ€•ç«ã€æ€•éŸ¿ã€‚æ‰€ä»¥éå¹´è¦è²¼ç´…æ˜¥è¯ã€ç‡ƒç¯ç«ã€æ”¾é­ç‚®ã€‚" },
            { q: "å¤§å¹´åˆäº”åˆç¨±ç‚ºã€Œç ´äº”ã€ï¼Œæœ€é‡è¦çš„æ°‘ä¿—æ´»å‹•æ˜¯ï¼Ÿ", a: ["å›å¨˜å®¶", "è¿è²¡ç¥", "è³èŠ±ç‡ˆ"], correct: 1, exp: "åˆäº”æ˜¯è²¡ç¥çš„ç”Ÿæ—¥ï¼Œä¹Ÿæ˜¯å•†åº—é–‹å¼µçš„æ—¥å­ï¼Œé€™å¤©è¦è¿è²¡ç¥ï¼Œä¿ä½‘ä¸€å¹´è²¡é‹äº¨é€šã€‚" },
            { q: "ã€Œå…ƒå®µç¯€ã€é€šå¸¸æ˜¯åœ¨è¾²æ›†æ­£æœˆçš„å“ªä¸€å¤©ï¼Ÿ", a: ["åˆä¸€", "åˆäº”", "åäº”"], correct: 2, exp: "æ­£æœˆåäº”æ˜¯æ–°å¹´çš„ç¬¬ä¸€å€‹æ»¿æœˆä¹‹å¤œï¼Œç¨±ç‚ºå…ƒå®µç¯€ï¼Œæ¨™èªŒè‘—æ˜¥ç¯€æ´»å‹•çš„åœ“æ»¿çµæŸã€‚" },
            { q: "å¤äººåœ¨éå¹´æ™‚æœƒå–ã€Œå± è˜‡é…’ã€ï¼Œå…¶é£²ç”¨é †åºæœ‰ä½•ç‰¹è‰²ï¼Ÿ", a: ["é•·è€…å…ˆå–", "ç”±å¹¼åŠé•·", "å…¨å®¶ä¸€èµ·ä¹¾æ¯"], correct: 1, exp: "å¤äººèªç‚ºå¹´å°‘è€…å¢æ­²å€¼å¾—æ…¶ç¥ï¼Œé•·è€…å¤±æ­²ä»¤äººæ„Ÿå‚·ï¼Œæ•…è®“å¹´å°‘è€…å…ˆå–ï¼Œé•·è€…æœ€å¾Œå–ã€‚" }
        ];

        const praiseWords = ["é¦¬åˆ°æˆåŠŸï¼", "é¾é¦¬ç²¾ç¥ï¼", "è¬é¦¬å¥”é¨°ï¼", "ä¸€é¦¬ç•¶å…ˆï¼", "æ‰è¯æ©«æº¢ï¼"];
        const missions = ["å­¸é¦¬é³´å«ä¸€è²ã€Œå˜¶ï½ã€ï¼", "è¡¨æ¼”ã€Œé¾é¦¬ç²¾ç¥ã€è·³èº 3 ä¸‹ï¼", "èªªå‡ºä¸‰å¥ã€Œé¦¬ã€å­—å‰ç¥¥è©±ï¼", "å¹«èº«é‚Šçš„äººå€’æ¯æ°´æˆ–æ‹¿é›¶é£Ÿï¼", "æ“ºä¸€å€‹å¸¥æ°£çš„é¨é¦¬ Poseï¼"];

        const pokedIndices = new Set();
        let currentIdx = -1;
        let audioCtx;
        const bgMusic = document.getElementById('bgMusic');
        let isMuted = false;

        function toggleMusic() {
            isMuted = !isMuted;
            const btn = document.getElementById('musicBtn');
            if (isMuted) {
                bgMusic.pause();
                btn.classList.add('muted');
            } else {
                bgMusic.play();
                btn.classList.remove('muted');
            }
        }

        function playSound(type) {
            if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            if (audioCtx.state === 'suspended') audioCtx.resume();

            const oscillator = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            oscillator.connect(gainNode);
            gainNode.connect(audioCtx.destination);

            if (type === 'success') {
                oscillator.type = 'triangle';
                oscillator.frequency.setValueAtTime(523, audioCtx.currentTime);
                oscillator.frequency.exponentialRampToValueAtTime(1046, audioCtx.currentTime + 0.2);
                gainNode.gain.setValueAtTime(0.1, audioCtx.currentTime);
                gainNode.gain.linearRampToValueAtTime(0, audioCtx.currentTime + 0.4);
            } else {
                oscillator.type = 'sawtooth';
                oscillator.frequency.setValueAtTime(150, audioCtx.currentTime);
                oscillator.frequency.linearRampToValueAtTime(70, audioCtx.currentTime + 0.3);
                gainNode.gain.setValueAtTime(0.1, audioCtx.currentTime);
                gainNode.gain.linearRampToValueAtTime(0, audioCtx.currentTime + 0.4);
            }
            oscillator.start();
            oscillator.stop(audioCtx.currentTime + 0.5);
        }

        function initGrid() {
            const container = document.getElementById('gridContainer');
            for (let i = 0; i < 16; i++) {
                const card = document.createElement('div');
                card.className = 'punch-card';
                card.innerHTML = `<span>${i + 1}</span>`;
                card.onclick = (e) => handlePoke(i, card);
                container.appendChild(card);
            }
        }

        function handlePoke(index, element) {
            if (pokedIndices.has(index)) return;
            
            if (!audioCtx) {
                audioCtx = new (window.AudioContext || window.webkitAudioContext)();
                if (!isMuted) bgMusic.play().catch(()=>{});
            }

            currentIdx = index;
            pokedIndices.add(index);
            element.classList.add('poked');
            showQuestion(index);
        }

        function showQuestion(index) {
            const data = questions[index];
            document.getElementById('questionCategory').innerText = (index < 6) ? "é¦¬å¹´ç‰¹é¸" : "å‚³çµ±æ°‘ä¿—";
            document.getElementById('questionText').innerText = data.q;
            const optionsGroup = document.getElementById('optionsGroup');
            optionsGroup.innerHTML = '';
            
            data.a.forEach((opt, i) => {
                const btn = document.createElement('button');
                btn.className = 'option-btn';
                btn.innerText = opt;
                btn.onclick = () => checkAnswer(i);
                optionsGroup.appendChild(btn);
            });

            document.getElementById('questionView').classList.remove('hidden');
            document.getElementById('resultView').classList.add('hidden');
            document.getElementById('gameModal').style.display = 'flex';
        }

        function checkAnswer(selected) {
            const data = questions[currentIdx];
            const isCorrect = (selected === data.correct);

            document.getElementById('questionView').classList.add('hidden');
            const resView = document.getElementById('resultView');
            resView.classList.remove('hidden');

            const title = document.getElementById('feedbackTitle');
            const icon = document.getElementById('feedbackIcon');
            const correctText = document.getElementById('correctAnswerText');
            const expText = document.getElementById('explanationText');
            const mBox = document.getElementById('missionBox');
            const mText = document.getElementById('missionText');

            correctText.innerText = data.a[data.correct];
            expText.innerText = data.exp;

            if (isCorrect) {
                playSound('success');
                icon.innerText = 'ğŸ”¥';
                title.innerText = praiseWords[Math.floor(Math.random() * praiseWords.length)];
                title.className = "text-2xl font-bold mb-3 text-red-600 animate-bounce";
                mBox.classList.add('hidden');
                createConfetti();
            } else {
                playSound('fail');
                icon.innerText = 'ğŸ¤”';
                title.innerText = "å¯æƒœäº†ï¼";
                title.className = "text-2xl font-bold mb-3 text-gray-700";
                mBox.classList.remove('hidden');
                mText.innerText = missions[Math.floor(Math.random() * missions.length)];
            }
        }

        function closeModal() {
            document.getElementById('gameModal').style.display = 'none';
        }

        function createConfetti() {
            const count = 40;
            const colors = ['#f9d423', '#d62828', '#ffffff', '#ff8e3c'];
            for (let i = 0; i < count; i++) {
                const conf = document.createElement('div');
                conf.className = 'confetti';
                conf.style.left = Math.random() * 100 + 'vw';
                conf.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                conf.style.top = '-10px';
                conf.style.transform = `rotate(${Math.random() * 360}deg)`;
                
                document.body.appendChild(conf);
                
                const animation = conf.animate([
                    { transform: `translate3d(0, 0, 0) rotate(0deg)`, opacity: 1 },
                    { transform: `translate3d(${(Math.random() - 0.5) * 200}px, 100vh, 0) rotate(${Math.random() * 720}deg)`, opacity: 0 }
                ], {
                    duration: 2000 + Math.random() * 1000,
                    easing: 'cubic-bezier(0, .9, .57, 1)'
                });

                animation.onfinish = () => conf.remove();
            }
        }

        window.onload = initGrid;
    </script>
</body>
</html>
